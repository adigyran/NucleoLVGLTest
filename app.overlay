#include <zephyr/dt-bindings/gpio/arduino-header-r3.h>
 
&rtc {
	status = "okay";
};
 
&timers12 {
	status = "disabled";
};
 
&leds {
	red_led: led_2 {
		gpios = <&gpiob 14 GPIO_ACTIVE_HIGH>;
		label = "User LD3";
	};
};
 
/ {
	chosen {
		zephyr,display = &rgb_oled;
	};
 
	aliases {
		led2 = &red_led;
	};
 
	mipi_dbi {
		compatible = "zephyr,mipi-dbi-spi";
		spi-dev = <&arduino_spi>;
		dc-gpios = <&arduino_header ARDUINO_HEADER_R3_D7 GPIO_ACTIVE_HIGH>;
		reset-gpios = <&arduino_header ARDUINO_HEADER_R3_D8 GPIO_ACTIVE_LOW>;
		write-only;
		#address-cells = <1>;
		#size-cells = <0>;
 
		rgb_oled: ssd1351@0 {
			compatible = "solomon,ssd1351";
			reg = <0>;
			mipi-mode = "MIPI_DBI_MODE_SPI_4WIRE";
			mipi-max-frequency = <40000000>;
			width = <128>;
			height = <128>;
			display-offset = <0>;
			start-line = <0>;
			multiplex-ratio = <127>;
			phase-length = <0x32>;
			oscillator-freq = <0xF1>;
			precharge-time = <0x08>;
			precharge-voltage = <0x1F>;
			vcomh-voltage = <0x05>;
			current-att = <0x0f>;
			remap-value = <0x74>;
		};
	};
};

/* SPI1 использует interrupt-driven режим (без DMA): D-cache включён,
 * и все буферы (включая стековые в драйвере инициализации дисплея)
 * работают без ограничений. DMA каналы оставлены в overlay для будущего
 * использования (ADC DMA, или если потребуется SPI DMA с nocache буферами).
 */
&arduino_spi {
	dmas = <&dmamux1 5 38 STM32_DMA_PERIPH_TX>,
	       <&dmamux1 6 37 STM32_DMA_PERIPH_RX>;
	dma-names = "tx", "rx";
};

&dma1 {
	status = "okay";
};

&dmamux1 {
	status = "okay";
};